<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Radium v184 - Visualizer</title>
    <style>
        :root { --wk-w: 85px; --bk-w: 52px; }

        /* --- ALL 20 THEMES --- */
        body.t1 { --bg: #000; --hdr: #111; --wk: #fff; --bk: #111; --glow: #008cff; --txt: #000; --btxt: #fff; } 
        body.t2 { --bg: #000; --hdr: #000; --wk: #111; --bk: #000; --glow: #ff0000; --txt: #fff; --btxt: #fff; } 
        body.t3 { --bg: #000; --hdr: #000; --wk: #111; --bk: #000; --glow: #00ff00; --txt: #fff; --btxt: #fff; } 
        body.t4 { --bg: #050112; --hdr: #000; --wk: #111; --bk: #000; --glow: #a855f7; --txt: #fff; --btxt: #fff; } 
        body.t5 { --bg: #000; --hdr: #000; --wk: #fff; --bk: #333; --glow: #fff; --txt: #000; --btxt: #fff; } 
        body.t6 { --bg: #00152b; --hdr: #000; --wk: #00152b; --bk: #008cff; --glow: #008cff; --txt: #fff; --btxt: #000; } 
        body.t7 { --bg: #2b0000; --hdr: #000; --wk: #2b0000; --bk: #ff4444; --glow: #ff4444; --txt: #fff; --btxt: #000; } 
        body.t8 { --bg: #000; --hdr: #000; --wk: #111; --bk: #f97316; --glow: #f97316; --txt: #fff; --btxt: #000; } 
        body.t9 { --bg: #000; --hdr: #000; --wk: #111; --bk: #ccff00; --glow: #ccff00; --txt: #fff; --btxt: #000; } 
        body.t10 { --bg: #000; --hdr: #000; --wk: #111; --bk: #00f2ff; --glow: #00f2ff; --txt: #fff; --btxt: #000; } 
        body.t11 { --bg: #f8fafc; --hdr: #fff; --wk: #fff; --bk: #3b82f6; --glow: #3b82f6; --txt: #000; --btxt: #fff; }
        body.t12 { --bg: #fff1f2; --hdr: #fff; --wk: #fff; --bk: #f43f5e; --glow: #f43f5e; --txt: #000; --btxt: #fff; }
        body.t13 { --bg: #f0fdf4; --hdr: #fff; --wk: #fff; --bk: #22c55e; --glow: #22c55e; --txt: #000; --btxt: #fff; }
        body.t14 { --bg: #faf5ff; --hdr: #fff; --wk: #fff; --bk: #a855f7; --glow: #a855f7; --txt: #000; --btxt: #fff; }
        body.t15 { --bg: #450a0a; --hdr: #2b0000; --wk: #b91c1c; --bk: #7f1d1d; --glow: #f87171; --txt: #fff; --btxt: #fff; } 
        body.t16 { --bg: #064e3b; --hdr: #022c22; --wk: #059669; --bk: #064e3b; --glow: #34d399; --txt: #fff; --btxt: #fff; } 
        body.t17 { --bg: #1e1b4b; --hdr: #0f172a; --wk: #4338ca; --bk: #1e1b4b; --glow: #818cf8; --txt: #fff; --btxt: #fff; } 
        body.t18 { --bg: #000; --hdr: #000; --wk: #fbbf24; --bk: #78350f; --glow: #f59e0b; --txt: #000; --btxt: #fff; } 
        body.t19 { --bg: #000; --hdr: #000; --wk: #db2777; --bk: #831843; --glow: #ff00ff; --txt: #fff; --btxt: #fff; } 
        body.t20 { --bg: #fff; --hdr: #f1f5f9; --wk: #fff; --bk: #000; --glow: #000; --txt: #000; --btxt: #fff; }

        * { -webkit-user-select: none; user-select: none; box-sizing: border-box; touch-action: none; outline: none; }
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; background: var(--bg); font-family: sans-serif; position: fixed; }

        #app { display: flex; flex-direction: column; width: 100vh; height: 100vw; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(90deg); }
        @media screen and (orientation: landscape) { #app { width: 100vw; height: 100vh; transform: translate(-50%, -50%) rotate(0deg); } }

        .header { height: 85px; background: rgba(0,0,0,0.8); border-bottom: 2px solid var(--glow); display: flex; align-items: center; padding: 0 30px; z-index: 1000; gap: 15px; }
        .menu-btn { background: var(--glow); color: #000; border: none; padding: 10px 18px; border-radius: 10px; font-weight: 900; font-size: 11px; cursor: pointer; }
        .vol-box { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 50px; border: 1px solid var(--glow); }
        .vol-btn { color: var(--glow); background: none; border: none; font-size: 24px; cursor: pointer; }
        .ctrl-group { display: flex; gap: 12px; align-items: center; margin-left: auto; } 
        .ui-btn { background: #000; color: #fff; border: 2.5px solid var(--glow); width: 45px; height: 45px; border-radius: 12px; font-size: 24px; display: flex; align-items: center; justify-content: center; }
        .fs-btn { background: var(--glow); color: #000; border: none; padding: 0 18px; height: 45px; border-radius: 12px; font-weight: 900; font-size: 12px; }

        .drop-box { position: absolute; top: 90px; background: rgba(0,0,0,0.95); border: 2px solid var(--glow); padding: 15px; border-radius: 15px; display: none; gap: 10px; z-index: 2000; flex-wrap: wrap; max-width: 440px; }
        .t-dot { width: 38px; height: 38px; border-radius: 50%; border: 2px solid #fff; cursor: pointer; overflow: hidden; }
        .t-preview { width: 100%; height: 100%; }

        .i-opt { font-size: 34px; cursor: pointer; opacity: 0.3; }
        .i-opt.active { opacity: 1; filter: drop-shadow(0 0 10px var(--glow)); }

        .viewport { flex: 1; position: relative; overflow: hidden; background: transparent; }
        #particleCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }
        .strip { position: absolute; height: 100%; display: flex; z-index: 10; }
        .key-box { position: relative; height: 100%; flex-shrink: 0; width: var(--wk-w); }
        .white { width: 96%; height: 100%; background: var(--wk) !important; border-radius: 0 0 15px 15px; margin: 0 auto; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 25px; color: var(--txt); font-weight: 900; font-size: 17px; border: 1px solid rgba(0,0,0,0.1); }
        .black { width: var(--bk-w); height: 58%; background: var(--bk) !important; position: absolute; top: 0; left: calc(var(--wk-w) - (var(--bk-w)/2)); z-index: 100; border-radius: 0 0 12px 12px; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 20px; color: var(--btxt); font-weight: 900; font-size: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .white.active, .black.active { background: #fff !important; color: #000 !important; transform: translateY(8px); z-index: 1000; }
        .glow-active { box-shadow: 0 0 90px 35px var(--key-color); }

        .nav-slider-container { height: 26px; background: #000; width: 100%; position: relative; border-bottom: 1px solid #333; }
        .nav-handle { width: 15%; height: 100%; background: var(--glow); position: absolute; border-radius: 6px; }
        #splash { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; cursor: pointer; }
    </style>
</head>
<body class="t1" onpointerup="isMouseDown=false" onpointerleave="isMouseDown=false">

<div id="splash" onclick="boot()">
    <h1 style="color:#008cff; font-size: 45px; margin:0;">RADIUM v184</h1>
    <p>VISUALIZER ENGINE â€¢ PARTICLE FX</p>
    <div style="margin-top:20px; border:2px solid #008cff; padding:10px 40px; border-radius:50px;">RESTORE SETTINGS</div>
</div>

<div id="app">
    <div class="header">
        <button class="menu-btn" onclick="toggle('themeDrop')">THEMES</button>
        <button class="menu-btn" onclick="toggle('instDrop')">SOUNDS</button>
        <div class="vol-box">
            <button class="vol-btn" onclick="updVol(-0.1)">-</button>
            <div id="volDisp" style="color:#fff; font-size:16px; font-weight:900; width:50px; text-align:center;">80%</div>
            <button class="vol-btn" onclick="updVol(0.1)">+</button>
        </div>
        <div class="ctrl-group">
            <button class="ui-btn" onclick="setZ(-10)">-</button>
            <button class="ui-btn" onclick="setZ(10)">+</button>
            <button class="fs-btn" onclick="toggleFS()">FULLSCREEN</button>
        </div>
    </div>

    <div id="themeDrop" class="drop-box" style="left: 30px;"></div>

    <div id="instDrop" class="drop-box" style="left: 125px;">
        <span class="i-opt" id="opt-piano" onclick="updI('piano', this)">ðŸŽ¹</span>
        <span class="i-opt" id="opt-epiano" onclick="updI('epiano', this)">ðŸŽ¹âš¡</span>
        <span class="i-opt" id="opt-sax" onclick="updI('sax', this)">ðŸŽ·</span>
        <span class="i-opt" id="opt-jazz" onclick="updI('jazz', this)">ðŸŽº</span>
        <span class="i-opt" id="opt-flute" onclick="updI('flute', this)">ðŸªˆ</span>
        <span class="i-opt" id="opt-guitar" onclick="updI('guitar', this)">ðŸŽ¸</span>
    </div>

    <div class="nav-slider-container" id="sliderBar"><div class="nav-handle" id="handle"></div></div>
    <div class="viewport">
        <canvas id="particleCanvas"></canvas>
        <div class="strip" id="strip"></div>
    </div>
</div>

<script>
    let aCtx, mGain, limiter, scrollX = 1400, currentInst = 'piano', zoom = 85, vol = 0.8;
    let activeNodes = new Map(), isMouseDown = false;
    let canvas, ctx, particles = [];

    const rainCols = ["#ff0000", "#ff7f00", "#ffff00", "#00ff00", "#00f2ff", "#0000ff", "#7c3aed", "#ff0055", "#fbbf24", "#22c55e"];
    const themeColors = [
        ["#fff", "#008cff"], ["#111", "#ff0000"], ["#111", "#00ff00"], ["#111", "#a855f7"], ["#fff", "#333"],
        ["#00152b", "#008cff"], ["#2b0000", "#ff4444"], ["#111", "#f97316"], ["#111", "#ccff00"], ["#111", "#00f2ff"],
        ["#fff", "#3b82f6"], ["#fff", "#f43f5e"], ["#fff", "#22c55e"], ["#fff", "#a855f7"], ["#b91c1c", "#7f1d1d"],
        ["#059669", "#064e3b"], ["#4338ca", "#1e1b4b"], ["#fbbf24", "#78350f"], ["#db2777", "#831843"], ["#fff", "#000"]
    ];

    const notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    const insts = {
        'piano': { type: 'triangle', g: 0.3, atk: 0.03, rel: 0.1, f: 12000 },
        'epiano': { type: 'sine', g: 0.35, atk: 0.02, rel: 0.2, f: 4000 },
        'sax': { type: 'sawtooth', g: 0.12, atk: 0.08, rel: 0.15, f: 2200 },
        'jazz': { type: 'square', g: 0.08, atk: 0.05, rel: 0.15, f: 3000 },
        'flute': { type: 'sine', g: 0.35, atk: 0.1, rel: 0.2, f: 8000 },
        'guitar': { type: 'triangle', g: 0.22, atk: 0.02, rel: 0.25, f: 10000 }
    };

    class Particle {
        constructor(x, y, color) {
            this.x = x; this.y = y; this.color = color;
            this.size = Math.random() * 5 + 2;
            this.speedX = (Math.random() - 0.5) * 3;
            this.speedY = -Math.random() * 5 - 2;
            this.opacity = 1;
        }
        update() { this.x += this.speedX; this.y += this.speedY; this.opacity -= 0.02; }
        draw() {
            ctx.globalAlpha = this.opacity;
            ctx.fillStyle = this.color;
            ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
        }
    }

    function initCanvas() {
        canvas = document.getElementById('particleCanvas');
        ctx = canvas.getContext('2d');
        const resize = () => {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
        };
        window.addEventListener('resize', resize); resize();
        animateParticles();
    }

    function animateParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles = particles.filter(p => p.opacity > 0);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animateParticles);
    }

    function spawnParticles(el, color) {
        const rect = el.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const startY = rect.bottom - 40;
        for (let i = 0; i < 8; i++) particles.push(new Particle(centerX, startY, color));
    }

    function generateThemeDots() {
        const drop = document.getElementById('themeDrop'); drop.innerHTML = "";
        themeColors.forEach((cols, i) => {
            const dot = document.createElement('div'); dot.className = 't-dot';
            dot.onclick = () => updT(`t${i+1}`);
            dot.innerHTML = `<div class="t-preview" style="background: linear-gradient(135deg, ${cols[0]} 50%, ${cols[1]} 50%)"></div>`;
            drop.appendChild(dot);
        });
    }

    function saveAll() {
        localStorage.setItem('rd_theme', document.body.className);
        localStorage.setItem('rd_inst', currentInst);
        localStorage.setItem('rd_vol', vol);
        localStorage.setItem('rd_zoom', zoom);
        localStorage.setItem('rd_scroll', scrollX);
    }

    function loadAll() {
        document.body.className = localStorage.getItem('rd_theme') || 't1';
        currentInst = localStorage.getItem('rd_inst') || 'piano';
        vol = parseFloat(localStorage.getItem('rd_vol') || 0.8);
        zoom = parseInt(localStorage.getItem('rd_zoom') || 85);
        scrollX = parseFloat(localStorage.getItem('rd_scroll') || 1400);
        document.querySelectorAll('.i-opt').forEach(o => o.classList.toggle('active', o.id === 'opt-'+currentInst));
        document.getElementById('volDisp').innerText = Math.round(vol * 100) + "%";
    }

    function boot() {
        aCtx = new (window.AudioContext || window.webkitAudioContext)();
        mGain = aCtx.createGain(); limiter = aCtx.createDynamicsCompressor();
        loadAll(); generateThemeDots(); initCanvas();
        mGain.connect(limiter); limiter.connect(aCtx.destination);
        mGain.gain.setValueAtTime(vol * 0.4, aCtx.currentTime);
        document.getElementById('splash').style.display = 'none';
        renderPiano(); initSlider(); updateScroll();
    }

    function updVol(v) {
        vol = Math.max(0, Math.min(1, vol + v));
        mGain.gain.setTargetAtTime(vol * 0.4, aCtx.currentTime, 0.05);
        document.getElementById('volDisp').innerText = Math.round(vol * 100) + "%";
        saveAll();
    }

    function toggle(id) {
        let d = document.getElementById(id), s = d.style.display === 'flex';
        document.querySelectorAll('.drop-box').forEach(b => b.style.display = 'none');
        d.style.display = s ? 'none' : 'flex';
    }

    function updT(t) { document.body.className = t; saveAll(); toggle('themeDrop'); }
    function updI(i, el) { 
        currentInst = i; document.querySelectorAll('.i-opt').forEach(o => o.classList.remove('active'));
        el.classList.add('active'); saveAll(); toggle('instDrop'); 
    }

    function setZ(v) { zoom = Math.max(60, Math.min(150, zoom + v)); renderPiano(); saveAll(); }
    function toggleFS() { if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }

    function renderPiano() {
        document.documentElement.style.setProperty('--wk-w', zoom + 'px');
        document.documentElement.style.setProperty('--bk-w', (zoom * 0.6) + 'px');
        const strip = document.getElementById('strip'); strip.innerHTML = "";
        for (let i = 21; i <= 108; i++) {
            const n = notes[i % 12], f = 440 * Math.pow(2, (i - 69) / 12);
            if (!n.includes('#')) {
                const box = document.createElement('div'); box.className = 'key-box';
                const wk = document.createElement('div'); wk.className = 'key white'; wk.innerText = n;
                wk.onpointerdown = (e) => { wk.releasePointerCapture(e.pointerId); isMouseDown = true; playKey(f, wk, i); };
                wk.onpointerenter = () => { if(isMouseDown) playKey(f, wk, i); };
                wk.onpointerup = wk.onpointerleave = () => stopKey(f);
                box.appendChild(wk);
                if (["C", "D", "F", "G", "A"].includes(n)) {
                    const bk = document.createElement('div'); bk.className = 'key black'; bk.innerText = n + "#";
                    const bf = 440 * Math.pow(2, (i + 1 - 69) / 12);
                    bk.onpointerdown = (e) => { e.stopPropagation(); bk.releasePointerCapture(e.pointerId); isMouseDown = true; playKey(bf, bk, i+1); };
                    bk.onpointerenter = () => { if(isMouseDown) playKey(bf, bk, i+1); };
                    bk.onpointerup = bk.onpointerleave = () => stopKey(bf);
                    box.appendChild(bk);
                }
                strip.appendChild(box);
            }
        }
        updateScroll();
    }

    function playKey(f, el, idx) {
        if (!aCtx || activeNodes.has(f)) return;
        const ins = insts[currentInst];
        const osc = aCtx.createOscillator(), vca = aCtx.createGain();
        osc.type = ins.type; osc.frequency.setValueAtTime(f, aCtx.currentTime);
        vca.gain.setValueAtTime(0, aCtx.currentTime);
        vca.gain.linearRampToValueAtTime(ins.g, aCtx.currentTime + 0.01); 
        osc.connect(vca); vca.connect(mGain);
        osc.start(); 
        
        const col = rainCols[idx % 10];
        el.style.setProperty('--key-color', col);
        el.classList.add('active', 'glow-active'); 
        spawnParticles(el, col);
        activeNodes.set(f, {osc, vca, el});
    }

    function stopKey(f) {
        if (!activeNodes.has(f)) return;
        const {osc, vca, el} = activeNodes.get(f);
        vca.gain.setTargetAtTime(0, aCtx.currentTime, 0.05);
        osc.stop(aCtx.currentTime + 0.1);
        el.classList.remove('active', 'glow-active'); 
        activeNodes.delete(f);
    }

    function updateScroll() {
        const strip = document.getElementById('strip'), handle = document.getElementById('handle'), bar = document.getElementById('sliderBar');
        const viewW = (window.innerHeight > window.innerWidth) ? window.innerHeight : window.innerWidth;
        const maxScroll = strip.offsetWidth - viewW;
        scrollX = Math.max(0, Math.min(maxScroll, scrollX));
        strip.style.transform = `translate3d(${-scrollX}px, 0, 0)`;
        handle.style.left = ((scrollX / (maxScroll || 1)) * (bar.offsetWidth - handle.offsetWidth)) + 'px';
        saveAll();
    }

    function initSlider() {
        const bar = document.getElementById('sliderBar'), handle = document.getElementById('handle');
        let drag = false;
        const move = (e) => {
            if(!drag) return;
            const clientX = (window.innerHeight > window.innerWidth) ? e.clientY : e.clientX;
            const rect = bar.getBoundingClientRect(), barL = (window.innerHeight > window.innerWidth) ? rect.top : rect.left;
            const barW = (window.innerHeight > window.innerWidth) ? rect.height : rect.width;
            let p = Math.max(0, Math.min(1, ((clientX - barL) - (handle.offsetWidth/2)) / (barW - handle.offsetWidth)));
            scrollX = p * (document.getElementById('strip').offsetWidth - ((window.innerHeight > window.innerWidth) ? window.innerHeight : window.innerWidth)); 
            updateScroll();
        };
        bar.onpointerdown = (e) => { drag = true; move(e); bar.setPointerCapture(e.pointerId); };
        bar.onpointermove = (e) => move(e);
        bar.onpointerup = () => drag = false;
    }
</script>
</body>
</html>
